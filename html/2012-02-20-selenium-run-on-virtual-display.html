<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>selenium - run tests on a virtual display</title>

    <!-- Bootstrap -->
    <!-- https://github.com/necolas/normalize.css -->
    <link href="/css/normalize.css" rel="stylesheet">
    <!-- https://github.com/oxalorg/sakura -->
    <link href="/css/sakura.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/custom.css"/>

    <!-- https://prismjs.com/ -->
    <!-- Plugins: Line Highlight, Line Numbers, Autolinker, File Highlight,
                  Keep Markup, Normalize Whitespace
    -->
    <!-- Langs: bash, c, cpp, docker, go, haskell, json, makefile, php, plsql,
                python, rust, smalltalk, sql, vim, yaml
    -->
    <link href="/css/prism.css" rel="stylesheet">
    <script src="/js/prism.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  </head>
  <body>
    <div class="content">
      <div class="page-header">
        <a href="/">vim, git, aws and other three-letter words</a>
      </div>
      <div class="post-title">
          <h1>selenium - run tests on a virtual display</h1>
      </div>
      <div class="post-body">
          <p>Selenium tests require browser to run, so usually we run them on the X-server enabled machine.
But in some cases, like CI system running on the headless EC2 instance, we want to run it on the virtual display.
This can be done using xvfb (X virtual framebuffer).</p>
<p><!-- more --></p>
<h2 id="set-up">Set up</h2>
<p>Install xvfb</p>
<pre><code class="lang-bash">    sudo apt-get install xvfb
</code></pre>
<p>Install x11vnc</p>
<pre><code class="lang-bash">    sudo apt-get install x11vnc
</code></pre>
<h2 id="run-tests-on-virtual-display">Run tests on virtual display</h2>
<p>Start xvbf (virtual display number 99)</p>
<pre><code class="lang-bash">    Xvfb -ac :99
</code></pre>
<p>Tell tests to run on virtual display</p>
<pre><code class="lang-bash">    export DISPLAY=:99
</code></pre>
<p>Or inside the test code (python)</p>
<pre><code class="lang-bash">    os.environ[&#39;DISPLAY&#39;] = &#39;:99&#39;
    ...
    selenium = webdriver.Firefox(firefox_profile=ffp, firefox_binary=ffb)
    ...
</code></pre>
<h2 id="watch-tests-running-on-virtual-display">Watch tests running on virtual display</h2>
<p>Start x11vnc server on the same display:</p>
<pre><code class="lang-bash">    x11vnc -display :99
</code></pre>
<p>Use vnc client (for example, <a href="https://launchpad.net/gtkvncviewer">gtkvncviewer</a>) to connect to the localhost and watch how tests are running.</p>
<h2 id="links">Links</h2>
<p><a href="http://serverfault.com/questions/273095/connect-to-xvfb-remote-to-fix-firefox-headless-crash">Stackoverflow</a></p>
<p><a href="http://www.semicomplete.com/blog/geekery/xvfb-firefox.html">Xvfb + Firefox</a></p>
<p><a href="http://markgandolfo.com/?p=47">Hudson Ci Server Running Selenium/Webdriver Cucumber In Headless Mode Xvfb</a></p>

      </div>
      <div>
<a href="https://stackexchange.com/users/261528">
<img src="https://stackexchange.com/users/flair/261528.png?theme=clean" width="208" height="58" alt="profile for Boris Serebrov on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for Boris Serebrov on Stack Exchange, a network of free, community-driven Q&amp;A sites">
</a>
      </div>
      <div>
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'serebrov'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58056088-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>

