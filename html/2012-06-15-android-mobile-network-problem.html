<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Andriod - moblie network problem after BusyBox update</title>

    <!-- Bootstrap -->
    <!-- https://github.com/necolas/normalize.css -->
    <link href="/css/normalize.css" rel="stylesheet">
    <!-- https://github.com/oxalorg/sakura -->
    <link href="/css/sakura.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/custom.css"/>

    <!-- https://prismjs.com/ -->
    <!-- Plugins: Line Highlight, Line Numbers, Autolinker, File Highlight,
                  Keep Markup, Normalize Whitespace
    -->
    <!-- Langs: bash, c, cpp, docker, go, haskell, json, makefile, php, plsql,
                python, rust, smalltalk, sql, vim, yaml
    -->
    <link href="/css/prism.css" rel="stylesheet">
    <script src="/js/prism.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  </head>
  <body>
    <div class="content">
      <div class="page-header">
        <a href="/">vim, git, aws and other three-letter words</a>
      </div>
      <div class="post-title">
          <h1>Andriod - moblie network problem after BusyBox update</h1>
      </div>
      <div class="post-body">
          <p>I have LG p500 (Optimus One), rooted with original ROM.</p>
<p>After update to <a href="https://play.google.com/store/apps/details?id=stericson.busybox">BusyBox</a> 1.20.1 my moblie GPRS network became broken. I got network indicator (E with two arrows), but can not access network.</p>
<p>I suspected that this was someting with dns settings, but did not find any solution. I uninstalled busybox, but this didn&#39;t help. I did a factory reset - also didn&#39;t help. Actually I thought factory reset wil return my device to the original state, but then noticed that I still have root and busybox.</p>
<!-- more -->
<p>So I started examining system logs and found this error:</p>
<pre><code>Failed to replace default route com.android.server.NativeDaemonConnectorException
06-12 17:04:40.999 E/NetworkManagmentService(1560)com.android.server.NetworkManagementService 994
Failed to replace default route com.android.server.NativeDaemonConnectorException:
Cmd {route replace def v4 rmnet0 31.144.159.49} failed with code 400 : {failed to replace default route for [rmnet0 -4] (I/O error)}: for iface [rmnet0]
06-12 17:04:40.999 E/NetworkStateTracker(1560)android.net.NetworkStateTracker 249
Unable to add default route.
</code></pre><p>I googled this error and found XDA thread which mention this error, page where it mentioned first - <a href="http://forum.xda-developers.com/showthread.php?t=1314898&amp;page=418">XDA forum thread, see post 4174</a>.</p>
<p>Note that I use original LG ROM (not the rom discussed in that thread). Few pages later there is a more detailed examination - <a href="http://forum.xda-developers.com/showthread.php?t=1314898&amp;page=428">see post 4272 and 4275</a>.</p>
<p>During discussion they suggested to try this command (I modified it a bit because original forum version gave error about wrong arguments. I issued this command in the <a href="https://play.google.com/store/apps/details?id=os.tools.scriptmanager">Script Manager</a> via su):</p>
<pre><code class="lang-bash">    su -c &quot;ip -4 route replace default via 109.46.130.66 dev rmnet0&quot;
</code></pre>
<p>Where ip (109.46.130.66) is ip address from the com.android.server.NativeDaemonConnectorException error above - I think this is dynamic dns server I got from my mobile network provider (different on each connection).
And this command makes network work! But only for curren session. When I reconnect GPRS the network doesn&#39;t work again (because new dns server ip is issued every time).</p>
<p>The final solution is to take an &quot;ip&quot; binary from the original rom and replace a busybox&#39;s version:</p>
<ul>
<li>Get the <a href="http://forum.xda-developers.com/showthread.php?t=1260920">stock rom</a></li>
<li>Extract system files from kdz format, <a href="http://forum.xda-developers.com/showthread.php?t=901417">how to</a></li>
<li>After extracting &quot;system.mbn&quot;: copy system/bin/ip to the device (somewhere, for example, sd card root).</li>
<li>Rename /system/bin/ip to /system/bin/ip_busybox (just a backup). To access system folder on the device I used <a href="https://play.google.com/store/apps/details?id=com.estrongs.android.pop">ES File Explorer</a> with root mode enabled.</li>
<li>Copy original &quot;ip&quot; (from sdcard root) to /system/bin/</li>
</ul>
<p>Finally I want to thank <a href="https://play.google.com/store/apps/details?id=stericson.busybox">BusyBox installer</a> developer, Stephen. I contacted him by email when I realized that problem was with busybox installer and he answered and put effort to help me find the solution. Also he posted about this issue in the mentioned above XDA thread (I could not do this because have no permission to post into developer topics on XDA).</p>

      </div>
      <div>
<a href="https://stackexchange.com/users/261528">
<img src="https://stackexchange.com/users/flair/261528.png?theme=clean" width="208" height="58" alt="profile for Boris Serebrov on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for Boris Serebrov on Stack Exchange, a network of free, community-driven Q&amp;A sites">
</a>
      </div>
      <div>
<div id="disqus_thread"></div>
<script>
var disqus_config = function () {
this.page.url = 'http://serebrov.github.io/html/2012-06-15-android-mobile-network-problem.html';  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'html/2012-06-15-android-mobile-network-problem.html'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://serebrov.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58056088-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>

