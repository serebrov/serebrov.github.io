<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="It seems that we have no perfect solution for class table inheritance (or multiple table inheritance) in yii (comparing to the very good one for single table inheritance).
Possible solutions are:
Add support for class table inheritance to the active record class. There are some implementations of this method (see here and here for examples). But I do not like this approach because it is too complex to implement it properly and to make it work for all possible active record usages."><meta name=theme-color content="#44ccff"><meta property="og:title" content="yii - class table inheritance • vim, git, aws and other three-letter words"><meta property="og:description" content="It seems that we have no perfect solution for class table inheritance (or multiple table inheritance) in yii (comparing to the very good one for single table inheritance).
Possible solutions are:
Add support for class table inheritance to the active record class. There are some implementations of this method (see here and here for examples). But I do not like this approach because it is too complex to implement it properly and to make it work for all possible active record usages."><meta property="og:url" content="https://serebrov.github.io/html/2012-02-01-yii-class-table-inheritance.html"><meta property="og:site_name" content="vim, git, aws and other three-letter words"><meta property="og:type" content="article"><meta property="article:section" content="archive"><meta property="article:tag" content="yii"><meta property="article:published_time" content="2012-02-01T00:00:00Z"><meta property="article:modified_time" content="2012-02-01T00:00:00Z"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.119.0"><title>yii - class table inheritance • vim, git, aws and other three-letter words</title><link rel=canonical href=https://serebrov.github.io/html/2012-02-01-yii-class-table-inheritance.html><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.6a060eb7.css><link rel=stylesheet href=/css/custom.css><style>:root{--color-accent:#44ccff}</style><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-58056088-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class='page type-archive has-sidebar'><div class=site><div id=sidebar class=sidebar><a class=screen-reader-text href=#main-menu>Skip to Main Menu</a><div class=container><section class='widget widget-about sep-after'><header><div class=logo><a href=/><img src=/images/logo.jpg></a></div><h2 class='title site-title'><a href=/>vim, git, aws and other three-letter words</a></h2><div class=desc>Software Development Notes</div></header></section><section class='widget widget-search sep-after'><header><h4 class='title widget-title'>Search</h4></header><form action=/search id=search-form class=search-form><label><span class=screen-reader-text>Search</span>
<input id=search-term class=search-term type=search name=q placeholder=Search&mldr;></label></form></section><section class='widget widget-sidebar_menu sep-after'><nav id=sidebar-menu class='menu sidebar-menu' aria-label='Sidebar Menu'><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/posts/>Posts</a></li><li class='item has-current'><a href=/archive/>Archive</a></li></ul></div></nav></section><section class='widget widget-taxonomy_cloud sep-after'><header><h4 class='title widget-title'>Tags</h4></header><div class='container list-container'><ul class='list taxonomy-cloud no-shuffle'><li><a href=/tags/ai/ style=font-size:1em>ai</a></li><li><a href=/tags/android/ style=font-size:1em>android</a></li><li><a href=/tags/angularjs/ style=font-size:1.0952380952380953em>angularjs</a></li><li><a href=/tags/aws/ style=font-size:1.8571428571428572em>aws</a></li><li><a href=/tags/bash/ style=font-size:1em>bash</a></li><li><a href=/tags/celery/ style=font-size:1em>celery</a></li><li><a href=/tags/chrome/ style=font-size:1em>chrome</a></li><li><a href=/tags/cmd/ style=font-size:1em>cmd</a></li><li><a href=/tags/cors/ style=font-size:1em>cors</a></li><li><a href=/tags/cw-logs/ style=font-size:1.0476190476190477em>cw-logs</a></li><li><a href=/tags/disqus/ style=font-size:1em>disqus</a></li><li><a href=/tags/docker/ style=font-size:1.0476190476190477em>docker</a></li><li><a href=/tags/drone/ style=font-size:1em>drone</a></li><li><a href=/tags/dynamodb/ style=font-size:1.0952380952380953em>dynamodb</a></li><li><a href=/tags/eb/ style=font-size:1.1904761904761905em>eb</a></li><li><a href=/tags/ejs/ style=font-size:1em>ejs</a></li><li><a href=/tags/emr/ style=font-size:1.0476190476190477em>emr</a></li><li><a href=/tags/express.js/ style=font-size:1em>express.js</a></li><li><a href=/tags/fastapi/ style=font-size:1em>fastapi</a></li><li><a href=/tags/git/ style=font-size:2em>git</a></li><li><a href=/tags/google-colab/ style=font-size:1em>google-colab</a></li><li><a href=/tags/hive/ style=font-size:1em>hive</a></li><li><a href=/tags/jquery/ style=font-size:1.0952380952380953em>jquery</a></li><li><a href=/tags/js/ style=font-size:1.0952380952380953em>js</a></li><li><a href=/tags/json/ style=font-size:1em>json</a></li><li><a href=/tags/kbd/ style=font-size:1.0952380952380953em>kbd</a></li><li><a href=/tags/linux/ style=font-size:1em>linux</a></li><li><a href=/tags/mongodb/ style=font-size:1em>mongodb</a></li><li><a href=/tags/mysql/ style=font-size:1.0476190476190477em>mysql</a></li><li><a href=/tags/node.js/ style=font-size:1.1904761904761905em>node.js</a></li><li><a href=/tags/npm/ style=font-size:1em>npm</a></li><li><a href=/tags/oauth/ style=font-size:1em>oauth</a></li><li><a href=/tags/oop/ style=font-size:1em>oop</a></li><li><a href=/tags/php/ style=font-size:1.1428571428571428em>php</a></li><li><a href=/tags/postgresql/ style=font-size:1em>postgresql</a></li><li><a href=/tags/python/ style=font-size:1.0952380952380953em>python</a></li><li><a href=/tags/rds/ style=font-size:1.0476190476190477em>rds</a></li><li><a href=/tags/scaleway/ style=font-size:1em>scaleway</a></li><li><a href=/tags/selenium/ style=font-size:1.2857142857142856em>selenium</a></li><li><a href=/tags/ssh/ style=font-size:1em>ssh</a></li><li><a href=/tags/tmux/ style=font-size:1em>tmux</a></li><li><a href=/tags/tts/ style=font-size:1em>tts</a></li><li><a href=/tags/typing/ style=font-size:1.0476190476190477em>typing</a></li><li><a href=/tags/vim/ style=font-size:1.0476190476190477em>vim</a></li><li><a href=/tags/vr/ style=font-size:1em>vr</a></li><li><a href=/tags/vue/ style=font-size:1.0952380952380953em>vue</a></li><li><a href=/tags/web/ style=font-size:1em>web</a></li><li><a href=/tags/yii/ style=font-size:1.1428571428571428em>yii</a></li><li><a href=/tags/zeromq/ style=font-size:1em>zeromq</a></li></ul></div></section></div><div class=sidebar-overlay></div></div><div class=main><nav id=main-menu class='menu main-menu' aria-label='Main Menu'><div class=container><a class=screen-reader-text href=#content>Skip to Content</a>
<button id=sidebar-toggler class=sidebar-toggler aria-controls=sidebar>
<span class=screen-reader-text>Toggle Sidebar</span>
<span class=open><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></span><span class=close><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></button><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/posts/>Posts</a></li><li class='item current'><a aria-current=page href=/archive/>Archive</a></li></ul></div></nav><div class=header-widgets><div class=container></div></div><header id=header class='header site-header'><div class='container sep-after'><div class=header-info><p class='site-title title'>vim, git, aws and other three-letter words</p><p class='desc site-desc'>Software Development Notes</p></div></div></header><main id=content><article lang=en class=entry><header class='header entry-header'><div class='container sep-after'><div class=header-info><h1 class=title>yii - class table inheritance</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2012-02-01T00:00:00Z>2012, Feb 01</time></span>
<span class=reading-time><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>6 mins read</span></div></div></header><div class="container entry-content custom"><p>It seems that we have no perfect solution for <a href=http://martinfowler.com/eaaCatalog/classTableInheritance.html>class table inheritance</a> (or multiple table inheritance) in yii (comparing to the very good one for <a href=http://www.yiiframework.com/wiki/198/single-table-inheritance/>single table inheritance</a>).</p><p>Possible solutions are:</p><ol><li>Add support for class table inheritance to the active record class. There are some implementations of this method (see <a href=http://www.yiiframework.com/forum/index.php?/topic/5803-my-multi-table-inheritance-approach/>here</a> and <a href=http://www.yiiframework.com/forum/index.php?/topic/12978-class-table-inheritance/page__view__findpost__p__64041>here</a> for examples). But I do not like this approach because it is too complex to implement it properly and to make it work for all possible active record usages.</li><li>Use MySQL VIEWs. MySQL supports a VIEW which can be updated by INSERT and UPDATE statements. So we can hide two tables (for base and child classes) behind the view and use it as a usual single table.</li><li>Use single table inheritance and keep an extended data in separate tables.</li></ol><p>I wanted to examine options #2 and #3 and made a <a href=https://github.com/sebgoo/yiimti>simple yii application</a>.</p><h2 id=mysql-views>MySQL VIEWs</h2><p>Using MySQL views we can join two or more tables on the database level and work with join result as with single table.
This approach could be a perfect solution, but unfortunately MySQL has some <a href=http://dev.mysql.com/doc/refman/5.0/en/view-updatability.html>limitations</a> related to views which join several tables.</p><p>I examined these limitations in my test application (<a href=https://github.com/sebgoo/yiimti/tree/master/www/protected/modules/view>see &ldquo;view&rdquo; module</a>) and found following issues:</p><ul><li>Some additional code needed to make active record work properly (it does not detects primary key automatically and does not set record id after insert). This issue is not critical and can be handled in active record subclass.</li><li>MySQL does not allow to delete records using view. This issue also can be handled in active record subclass - we can emulate delete method and do actual delete from joined tables.</li><li>MySQL does not allow to update both joined tables at once. This is very disappointing and breaks the idea of hiding two tables behind the view.
Of cause some workarounds are possible, for example in my sample app I show only fields from the base table when creating a record and only fields from the extended table when updating. But actually this limitation makes the whole idea of using VIEWS for class table inheritance no so good.</li></ul><p>A controller code in this case can remain simple and similar to the single table case, but you anyway should remember that you use the view and not a single table and do special handling in the UI on in the controller when you create / update records.
So views can not provide a good abstract level when you want to create and update records.</p><p>MySQL VIEWS are good solution for list or grid views. The code in this case will be exactly the same as for the single table.</p><h2 id=single-table-inheritance-and-additional-data-in-external-tables>Single table inheritance and additional data in external tables</h2><p>This approach is implemented in the <a href=https://github.com/sebgoo/yiimti/tree/master/www/protected/modules/aggregation>&ldquo;aggregation&rdquo; module</a> of my test application.
A data structure is following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- single table inheritance table
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>car<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> INT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT ,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> VARCHAR(<span style=color:#ae81ff>45</span>) <span style=color:#66d9ef>NULL</span> ,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span><span style=color:#66d9ef>type</span><span style=color:#f92672>`</span> ENUM(<span style=color:#e6db74>&#39;Car&#39;</span>,<span style=color:#e6db74>&#39;SportCar&#39;</span>,<span style=color:#e6db74>&#39;FamilyCar&#39;</span>) <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;Car&#39;</span> ,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>) )
</span></span><span style=display:flex><span>ENGINE <span style=color:#f92672>=</span> InnoDB;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- additional data for a SportCar class
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>sport_car_data<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>car_id<span style=color:#f92672>`</span> INT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> ,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>power<span style=color:#f92672>`</span> INT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> ,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>car_id<span style=color:#f92672>`</span>) ,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTRAINT</span> <span style=color:#f92672>`</span>fk_sport_car_data_car<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>car_id<span style=color:#f92672>`</span> )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>REFERENCES</span> <span style=color:#f92672>`</span>car<span style=color:#f92672>`</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> ))
</span></span><span style=display:flex><span>ENGINE <span style=color:#f92672>=</span> InnoDB;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- additional data for a FamilyCar class
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>family_car_data<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>car_id<span style=color:#f92672>`</span> INT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> ,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>seats<span style=color:#f92672>`</span> INT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> ,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>car_id<span style=color:#f92672>`</span>) ,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>CONSTRAINT</span> <span style=color:#f92672>`</span>fk_family_car_data_car<span style=color:#f92672>`</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>car_id<span style=color:#f92672>`</span> )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>REFERENCES</span> <span style=color:#f92672>`</span>car<span style=color:#f92672>`</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> ))
</span></span><span style=display:flex><span>ENGINE <span style=color:#f92672>=</span> InnoDB;
</span></span></code></pre></div><p>Here the &lsquo;car&rsquo; table is a single inheritance table with type field (ENUM with class names).
Base class is &lsquo;Car&rsquo;:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Car</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>CActiveRecord</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>tableName</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;car&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>instantiate</span>($attributes) {
</span></span><span style=display:flex><span>        $class<span style=color:#f92672>=</span>$attributes[<span style=color:#e6db74>&#39;type&#39;</span>];
</span></span><span style=display:flex><span>        $model<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> $class(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $model;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>beforeSave</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isNewRecord</span>) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>type</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>get_class</span>($this);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>parent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>beforeSave</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FamilyCar</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Car</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>tableName</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;car&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>relations</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;data&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span>(<span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>HAS_ONE</span>, <span style=color:#e6db74>&#39;FamilyCarData&#39;</span>, <span style=color:#e6db74>&#39;car_id&#39;</span>),
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>defaultScope</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;condition&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#34;type=&#39;FamilyCar&#39;&#34;</span>,
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SportCar</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Car</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>tableName</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;car&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>relations</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;data&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span>(<span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>HAS_ONE</span>, <span style=color:#e6db74>&#39;SportCarData&#39;</span>, <span style=color:#e6db74>&#39;car_id&#39;</span>),
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>defaultScope</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;condition&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#34;type=&#39;SportCar&#39;&#34;</span>,
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Some notes:</p><ol><li>Class name is used as value for &ldquo;type&rdquo; field, so there is no need in switch in the <code>Car::instantiante</code> method (like in the <a href=http://www.yiiframework.com/wiki/198/single-table-inheritance/>original solution</a>).</li><li>The <code>Car::defaultScope()</code> method is defined in the child classes only. This way we can use base <code>Car</code> class to process all models regardless of type and child classes <code>FamilyCar</code> and <code>SportCar</code> to work with one model type only.</li><li>Child classes have ‘data’ relation which points to the model with extended type data. In this case <code>FamilyCarData</code> and <code>SportCarData</code> are such models with extended data.</li></ol><p>With this approach you should handle two models in controllers and views related to subclasses (<code>FamilyCar</code> and <code>SportCar</code>).</p><p>For example, create action in the <code>FamilyCar</code> controller:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PHP data-lang=PHP><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>actionCreate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//create base model and model with extended data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $model<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FamilyCar</span>;
</span></span><span style=display:flex><span>    $model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FamilyCarData</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;FamilyCarData&#39;</span>])) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>//get properties for both models and save them
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//of cause it is better to use transaction here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>attributes</span><span style=color:#f92672>=</span>$_POST[<span style=color:#e6db74>&#39;FamilyCar&#39;</span>];
</span></span><span style=display:flex><span>        $model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>attributes</span><span style=color:#f92672>=</span>$_POST[<span style=color:#e6db74>&#39;FamilyCarData&#39;</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>($model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>()) {
</span></span><span style=display:flex><span>            $model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>car_id</span> <span style=color:#f92672>=</span> $model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> ($model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>save</span>()) {
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>redirect</span>(<span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;view&#39;</span>,<span style=color:#e6db74>&#39;id&#39;</span><span style=color:#f92672>=&gt;</span>$model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span>));
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>render</span>(<span style=color:#e6db74>&#39;create&#39;</span>,<span style=color:#66d9ef>array</span>(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;model&#39;</span><span style=color:#f92672>=&gt;</span>$model,
</span></span><span style=display:flex><span>    ));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And the view code will be like this:</p><pre tabindex=0><code class=language-html+php data-lang=html+php>&lt;div class=&#34;form&#34;&gt;

&lt;?php $form=$this-&gt;beginWidget(&#39;CActiveForm&#39;, array(
    &#39;id&#39;=&gt;&#39;family-car-form&#39;,
    &#39;enableAjaxValidation&#39;=&gt;false,
)); ?&gt;

    &lt;p class=&#34;note&#34;&gt;Fields with &lt;span class=&#34;required&#34;&gt;*&lt;/span&gt; are required.&lt;/p&gt;

    &lt;?php echo $form-&gt;errorSummary($model); ?&gt;

    &lt;div class=&#34;row&#34;&gt;
        &lt;?php echo $form-&gt;labelEx($model,&#39;name&#39;); ?&gt;
        &lt;?php echo $form-&gt;textField($model,&#39;name&#39;); ?&gt;
        &lt;?php echo $form-&gt;error($model,&#39;name&#39;); ?&gt;
    &lt;/div&gt;
    &lt;div class=&#34;row&#34;&gt;
        &lt;?php echo $form-&gt;labelEx($model-&gt;data,&#39;seats&#39;); ?&gt;
        &lt;?php echo $form-&gt;textField($model-&gt;data,&#39;seats&#39;); ?&gt;
        &lt;?php echo $form-&gt;error($model-&gt;data,&#39;seats&#39;); ?&gt;
    &lt;/div&gt;

    &lt;div class=&#34;row buttons&#34;&gt;
        &lt;?php echo CHtml::submitButton($model-&gt;isNewRecord ? &#39;Create&#39; : &#39;Save&#39;); ?&gt;
    &lt;/div&gt;

&lt;?php $this-&gt;endWidget(); ?&gt;

&lt;/div&gt;&lt;!-- form --&gt;
</code></pre><p>Here we can access extended data through relation: <code>$model->data</code>.</p><h2 id=summary>Summary</h2><p>It is possible to use MySQL views to implement class table inheritance, but I would not recommend this, because of complexities with create / update data code.
Views are convenient when you list records and simplify configuration of CListView and CGRidView widgets.</p><p>In my opinion the solution with single table inheritance and extended data in separate tables is the best choice here.
Yes, you will have to handle two models in your controllers / views and should re-organize your classes hierarchy, but you have a clean view of what is going on and the fact you actually use two database tables is explicit.</p><p>This approach can be combined with MySQL views which are good for list and grid views (but not for create / update forms).</p><h2 id=links>Links</h2><p><a href=http://www.martinfowler.com/eaaCatalog/classTableInheritance.html>Class table inheritance pattern</a></p><p><a href=http://www.yiiframework.com/wiki/198/single-table-inheritance/>Single table inheritance implementation in yii</a></p><p><a href=http://dev.mysql.com/doc/refman/5.0/en/view-updatability.html>MySQL - updatable views</a></p><p><a href=http://www.yiiframework.com/forum/index.php?/topic/12978-class-table-inheritance>Yii forum topic - class table inheritance</a></p><p><a href=http://www.yiiframework.com/forum/index.php?/topic/5803-my-multi-table-inheritance-approach/>Yii forum topic - multiple table inheritance approach</a></p><p><a href=http://www.yiiframework.com/forum/index.php?/topic/23405-cactiverecord-inheritance-and-dynamic-attributes/>Yii forum topic - inheritance and dynamic attributes</a></p><p><a href=http://www.yiiframework.com/forum/index.php?/topic/11131-inheritance-extending-a-model/>Yii forum topic - another inheritance approach</a></p><a href=https://stackexchange.com/users/261528><img src="https://stackexchange.com/users/flair/261528.png?theme=clean" width=208 height=58 alt="profile for Boris Serebrov on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for Boris Serebrov on Stack Exchange, a network of free, community-driven Q&amp;A sites"></a></div><div class=popup><div class=close>close</div><div class=download><a href target=_blank>Download (<span class=name></span>)</a></div><div class=popup-content></div></div><footer class=entry-footer><div class='container sep-before'><div class=tags><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/yii/>yii</a></div></div></footer></article><nav class=entry-nav><div class=container><div class='prev-entry sep-before'><a href=/html/2012-04-24-git-fugitive-to-resolve-conflicts.html><span aria-hidden=true><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Andriod - moblie network problem after BusyBox update</a></div><div class='next-entry sep-before'><a href=/html/2012-02-20-selenium-run-on-virtual-display.html><span class=screen-reader-text>Next post: </span>selenium - run tests on a virtual display<span aria-hidden=true>Next<svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav><section id=comments class=comments><div class='container sep-before'><div class=comments-area><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="http://serebrov.github.io/html/2012-02-01-yii-class-table-inheritance.html"};(function(){var e=document,t=e.createElement("script");t.src="https://serebrov.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></section></main><footer id=footer class=footer><div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'><ul><li><a href=https://github.com/serebrov target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=mailto:serebrov@gmail.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2025 Boris Serebrov</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=https://serebrov.github.io/assets/js/main.67d669ac.js></script><script src=/js/jquery.min.js></script><script src=/js/custom.js></script></body></html>